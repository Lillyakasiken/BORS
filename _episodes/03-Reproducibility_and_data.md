---
# Please do not edit this file directly; it is auto generated.
# Instead, please edit 03-Reproducibility_and_data.md in _episodes_rmd/
source: Rmd
title: "Reproducibility and Data"
teaching: 0
exercises: 0
questions: 
  - "here are questions"
  - "tbd"
  - "by eva"
objectives: 
  - "tbd"
  - "by eva"
keypoints:
  - "tbd"
  - "by eva"
---




![]({{ page.root }}/fig/Repro_Kreislauf_horizontal_halb.png)

>## This week we learn some background and a few simple habits favoring reproducibility
>
1. Background on the reproducibility crisis  
>
2. How to organize projects and software code to favor reproducibility
>
3. How to handle data in spreadsheets to favor reproducibility
>
4. Some practical tips for the use of Rstudio (optional)
{: .checklist}

&nbsp;

&nbsp;

# 1. Background

>## Recall: Reproducibility vs Replicability
>
**Reproducibility** refers to the ability of a researcher to duplicate the results of a prior study using the same materials as were used by the original investigator.
>
This requires, at minimum, the sharing of data sets, relevant metadata, analytical code, and related software.
>
**Replicability** refers to the ability of a researcher to duplicate the results of a prior study if the same procedures are followed but new data are collected.
>
S Goodman https://www.science.org/doi/10.1126/scitranslmed.aaf5027
{: .keypoints}

&nbsp;

## Retracted Nature paper
![]({{ page.root }}/fig/03-01retraction.png)  


W Huang et al. https://www.nature.com/articles/s41586-018-0311-z



“In follow-up experiments to this article, we have been **unable to replicate** key aspects of the original results.”


- important finding on how a special type of RNA can affect T-cells  
- potential therapeutic effects and new drugs for autoimmune diseases  
- authors retracted the paper in 2018  

For more information, see [commentary on Retraction Watch.](http://retractionwatch.com/2018/07/09/researchers-pull-nature-paper-over-first-authors-objections/)  

&nbsp;

## Issues with reproducibility/replication affect many fields 

Biomedicine  
![]({{ page.root }}/fig/03-RetractionBiomedicine.png)  

- Drug target validation in oncology, women’s health, and cardiovascular diseases  
- Only 22 of 67 papers were fully or partially confirmed  
F Prinz et al.https://www.nature.com/articles/nrd3439-c1 

&nbsp;

Psychology  
![]({{ page.root }}/fig/03-RetractionPsychology.png)  

- Only 39 of 100 replication studies were significant  
- Mean effect size 50% as in original studies  
Open Science Collaboration https://www.science.org/doi/10.1126/science.aac4716 

&nbsp;

Economics  
![]({{ page.root }}/fig/03-RetractionEconomics.png)  

- Significant effect in 11 of 18 studies  
- Mean effect size 66% as in original studies  
C Camerer et al. https://www.science.org/doi/10.1126/science.aaf0918

&nbsp;

Social Sciences  
![]({{ page.root }}/fig/03-RetractionSocialSciences.png)  

- Significant effect in 13 of 21 studies  
- Mean effect size 50% as in original studies  
C Camerer et al. https://www.nature.com/articles/s41562-018-0399-z

&nbsp;

## Is there a reproducibility crisis?  
![]({{ page.root }}/fig/03-ReproCrisis01.png){: height="150px"} ![]({{ page.root }}/fig/03-ReproCrisis02.png){: height="150px"}  
M. Baker https://www.nature.com/articles/533452


&nbsp;

## Factors contributing to irreproducible research  

![]({{ page.root }}/fig/03-ReproCrisis04.png)  
&nbsp;

## What does working reproducibly mean for my daily work?  
> _“Working transparently and reproducibly has a lot to do with empathy: put yourself into the shoes of one of your collaboration partners and ask yourself, would that person be able to access my data and make sense of my analyses. Learning the tools of the trade will require commitment and a massive investment of your time and energy. A priori it is not clear why the benefits of working reproducibly outweigh its costs.”_

**Five selfish reasons to work reproducibly**  

F Markowetz https://genomebiology.biomedcentral.com/articles/10.1186/s13059-015-0850-7
&nbsp;

>## Reason number 1: reproducibility helps to avoid disaster  
>> _“This experience showed me two things. First of all, a project is more than a beautiful result. You need to **record in detail how you got there**. And second, starting to work reproducibly early on will **save you time later**. We wasted years of our and our collaborators’ time by not being able to reproduce our own results. All of this could have been avoided by keeping better track of how the data and analyses evolved over time.”_
{: .keypoints}

&nbsp;

>## Reason number 2: reproducibility makes it easier to write papers  
>> _“Transparency in your analysis makes writing papers much easier. For example, in a dynamic document (Box 1) all **results automatically update when the data are changed**. You can be confident your numbers, figures and tables are up-to-date. Additionally, transparent analyses are more engaging, more eyes can look over them and it is much easier to spot mistakes.”_
{: .keypoints}

&nbsp;

>## Reason number 3: reproducibility helps reviewers see it your way  
>> _“One of the reviewers proposed a slight change to some analyses, and because he had **access to the complete analysis**, he could directly try out his ideas on our data and see how the results changed.”_
{: .keypoints}

&nbsp;

>## Reason number 4: reproducibility enables continuity of your work  
>> _“I did this analysis 6 months ago. Of course I can’t remember all the details after such a long time.”_
{: .keypoints}

&nbsp;

>## Reason number 5: reproducibility helps to build your reputation  
> _“Generally, making your analyses available in this way will help you to build a reputation for being an honest and careful researcher. Should there ever be a problem with one of your papers, you will be in a very good position to defend yourself and to show that you reported everything in good faith.”_
{: .keypoints}

&nbsp;

>## Tools of the trade
>> _“At the lowest level, working reproducibly just means avoiding beginners’ mistakes. Keep your project organized, name your files and directories in some informative way, store your data and code at a single backed-up location. Don’t spread your data over different servers, laptops and hard drives.”_  
>
- scripting analyses, for example, in R and dynamic reporting using knitR http://yihui.name/knitr/  
- version control analysis development with, e.g. git https://git-scm.com/  
- self-contained and transportable analyses using, e.g. docker http://www.docker.com/  
{: .checklist}

&nbsp;


&nbsp;


&nbsp;




# 2. Organization and software


>## Project organization  
>Separation of  
>
- **data**  
- **method**  
- **output**
>
>
>Preservation of  
- **computational environment**  
{: .checklist}

&nbsp;

>## Project organization  
>
1. Put each project in its own directory named after the project.
2. Put text associated documents in the `doc` directory.
3. Put raw data and metadata in a `data` directory and files generated during cleanup and analysis in a `results` directory.
4. Put project source code in the `src` directory.
5. Put external scripts or compiled programs in the `bin` directory.
6. Name all files to reflect their content or function.
>
**Good enough practices in scientific computing**
>
G Wilson et al. https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1005510  
{: .checklist}

&nbsp;

## Projects as research compedia

![]({{ page.root }}/fig/03-Project02.png)

Examples of project organizations
![]({{ page.root }}/fig/03-Project01.png)  

**Packaging Data Analytical Work Reproducibly Using R (and Friends)**  

B Marwick et al. https://www.tandfonline.com/doi/full/10.1080/00031305.2017.1375986
 

&nbsp;

>## Software  
Use the following principles that make software/code/programs  
>
> - easier to understand and use 
> - by others and your future self  
>
>   1. Place a brief explanatory comment at the start of every program.  
>   2. Decompose programs into functions.  
>   3. Be ruthless about eliminating duplication.  
>   4. Search for well-maintained libraries that do what you need.  
>   5. Test libraries before relying on them.  
>   6. Give functions and variables meaningful names.  
>   7. Make dependencies and requirements explicit.  
>   8. Do not comment and uncomment code sections to control behavior.  
>   9. Provide a simple example or test data set.  
>
>
&rArr; Your main goal with these principles is for your code to be **readable, reusable, testable**  
{: .checklist}

&nbsp;

>## Code styling 
![]({{ page.root }}/fig/03-Meme.png)  
{: .testimonial}

>## Over the years I have assembled ten rules for code styling in R (in my personal order of importance):
>
1. Code styling is about readability not about correctness. The most important factor for readability is **consistency** which also increases writing efficiency. 
2. Use **white space** for readability, spaces around operators (e.g. +), after commas and before %>%, line breaks before each command and after each %>%.
3. Control the **length of your code lines** to be about 80 characters. Short statements, even loops etc, can be a single line.
4. **Indent** your code consistently, the preferred way of indentation are two spaces.
5. Use concise and informative variable names, do not use spaces, link by underscore or use CamelCase. Avoid names, that are already used, e.g., `mean`, `c`. 
6. **Comment** your code such that its structure is visible and findable (code folding in RStudio). Indicate decisions and reasons for those.
7. Do not use the equal sign for assignment, <- is the appropriate operator for this. Avoid right-hand assignment, ->, since it deteriorates readability.
8. Curly braces are a crucial programming tool in R. The opening { should be the last character on the line, the closing } the first (and last) on the line.
9. File naming is part of good programming style. Do not use spaces or non-standard characters, use consistent and informative names.
10. Do use the assistance provided by RStudio: command/control + i and shift + command/ctrl + A.
>
These rules were summarized from https://style.tidyverse.org, https://google.github.io/styleguide/Rguide.html, https://cfss.uchicago.edu/notes/style-guide/ and from lot of experience in reading code by others and my past self
{: .checklist}

&nbsp;

>## More tools to follow during the semester  
>
- Data management: data in spreadsheets  
- Collaboration: OSF, switchdrive, git  
- Manuscripts: first experience in dynamic reporting  
{: .checklist}

&nbsp;

&nbsp;

&nbsp;




# 3. Data in spreadsheets

&nbsp;

>## Data organization in spreadsheets
>
> _“By following this advice, researchers will create spreadsheets that are **less error-prone, easier for computers to process**, and **easier to share** with collaborators and the public. Spreadsheets that adhere to our recommendations will work well with the tidy tools and reproducible methods described elsewhere in this collection and will **form the basis of a robust and reproducible analytic workflow**.”_  
>
K Broman and K Woo https://www.tandfonline.com/doi/full/10.1080/00031305.2017.1375989  
>
&nbsp;
>
![]({{ page.root }}/fig/03-Meme02.png)  
https://xkcd.com/2180/  
{: .testimonial}

&nbsp;

 
>## Consistency  
>
1. Use consistent codes for categorical variables.
2. Use a consistent fixed code for any missing values.
3. Use consistent variable names.
4. Use consistent subject identifiers.
5. Use a consistent data layout in multiple files.
6. Use consistent file names.
7. Use a consistent format for all dates.
8. Use consistent phrases in your notes.
9. Be careful about extra spaces within cells.
{: .checklist}

&nbsp;

>## Choose good names for files and variables
>
- No spaces  
- Use underscores or hyphens or periods (only one of them)  
- No special characters (&,*,%,ü,ä,ö,...)  
- Use a unique, short but meaningful name  
- Variable names have to start with a letter  
{: .checklist}

&nbsp;

>## Be careful with dates  
![]({{ page.root }}/fig/03-Meme03.png)
https://xkcd.com/1179/
{: .testimonial}
>
- Use the ISO 8601 global standard  
- Convention for dates in Excel is different on Windows and Mac computers  
- Dates have an internal numerical representation  
- Best to declare date columns as text, but only works prospectively  
- Consider separate year, month, day columns  
{: .checklist}

&nbsp;

&nbsp;

 
>## Other tips  
>
- Consistent missing value coding: empty cell/NA/~~99999~~  
- One information of the same form per cell  
- No remarks in cells, e.g. >10000  
- Rectangle: one variable per column, one row per subject  
- First and only the first row for variable names  
- No means, standard deviations etc in the last row  
{: .checklist}

&nbsp;


>## Code book/data dictionary  
>
>- Create a code book in a separate sheet or file  
>- Code book contains  
>
  - a short description  
  - unit and max/min values for continuous variables  
  - all levels with their code for categorical variables  
  - ordering for ordinal variables  
>
- All variables have to be contained in the code book  
{: .checklist}

&nbsp;

 
>## Good practice  
>
- Do not color, highlight or merge cells  
- Do not calculate means, standard deviations or similar in raw data files  
- Consider write protecting a file at the end of data collection  
- Use data validation at data entry  
- Be careful with commas since they may be decimal separators  
>
>&nbsp;
>
![]({{ page.root }}/fig/03-Meme04.png)  
>
https://starecat.com/content/wp-content/uploads/me-excel-switches-number-to-a-date-friends-joey-learning-french.jpg
{: .testimonial}

&nbsp;

&nbsp;


## Description of the data set

Antibiotic susceptibility testing (AST) methods aim to quantify the susceptibility of certain species of bacteria to show resistance to certain antibiotics. AST methods are therefore applied to drug-species combinations. The AST method under study here is based on bacterial cultures, more specifically on measuring the diameter of areas without bacterial growth (zones of inhibition) around paper discs containing the antibiotic on agar culture dishes that have been evenly inoculated with bacteria. In other words, the larger the diameter the better the effect of the antibiotic. And, if the diameter is smaller than a specified target value the specific bacterial strain can be considered resistant to the antibiotic.

For each of the drug-species combinations a target diameter value for a standard setup ("Reference") is available. This target value has to be met as closely as possible in a laboratory for the standard setup in order for tests that are carried out in the laboratory to be reliable. Target values are issued by the European Committee on Antimicrobial Susceptibility Testing and represent a broad scientific consensus. The retrieval date of the target value is also given.

The data at disposition originate from tests at the Institute of Medical Microbiology of the University of Zurich. The institute tested several slightly different setups. Among others, different techniques for the preparation of the bacterial suspension (inoculum) were tested.
The available data contain the numbers of occurring diameters from the testing of a set of antibiotics and four species of bacteria from reference strains. Data from two experimental setups are available, setup “Test” with fixed and setup “Reference” with varying inoculum preparation. 


>## Homework
>
Considering the input on data in spreadsheets improve the spreadsheet
>
[DrugSpecies.xls]({{ page.root }}/files/docs/03/DrugSpecies.xlsx )
>
A description what the data set contains is given below. For this homework, please make your changes directly in the xls file for this example (we will practice using `R` to do it in class). Be sure to keep the original file.
>
>>## Specifically you should check  
>>
>> - plausibility of all observations (e.g. value in correct range)
>> - correct and consistent format of the entries, e.g. spelling or encoding errors 
>> - date formats 
>> - format of missing values
>> - variable names
>> - overall layout of the spreadsheet (header, merged cells, entries that are not observations etc.)
>{: .checklist}
>The code book will be checked in class, you do not need to work on this.
{: .challenge}

&nbsp;
&nbsp;






>## In-classtask
>
>>## Task 1
>>
>>We continue to work on the spreadsheet [DrugSpecies.xls]({{ page.root }}/files/docs/03/DrugSpecies.xlsx ). This time we will use `R` to correct the errors in the spreadsheet. Start by looking at the `R` script [DatainSpreadsheet.R]({{ page.root }}/files/docs/03/DatainSpreadsheet.R) which considers the first sheet of the Excel file
>>
1. Save the script file and the corresponding data file in an appropriate folder structure.
2. Adapt the paths for loading the data and writing the changed file accordingly.
3. Correct all errors by running the code and try to understand, comment appropriately.
4. Make any changes in code style that you deem necessary.
6. Save your changes in the same script file.
>{: .checklist}
>
>&nbsp;
>
>>## Task 2
>>
Next we consider the code book. 
>>
1. Read in the data again, this time by selecting the second sheet.
2. Correct all issues with the code book by running the code and try to understand, comment appropriately.
3. Save your changes in the same script file.
>{: .checklist}
>
>&nbsp;
>
>>## Task 3 (if time permits)
>>
We continue to prepare these data for analysis (even though we will not carry out the analysis). Ammend the script `DatainSpreadsheet.R` in order to
>>
1. Transform all variables into correct variable types, where this has not been done already.
2. The data contained in the file are counts of diameters, how would you transform these counts into actual observations of diameters?
3. Save the code with which you do this in the same script file.
>{: .checklist}
>
>&nbsp;
>
{: .challenge}

&nbsp;
&nbsp;


